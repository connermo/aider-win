# Aider 离线 Windows 包构建指南

## 📋 概述

本项目提供了一套完整的脚本，用于自动构建 Aider 的**完全离线 Windows 版本**，适用于内网环境通过 OpenAI Compatible API 连接大模型服务。

## 🎯 特点

- ✅ **完全离线**：构建后的包无需互联网连接
- ✅ **一键构建**：自动化下载、编译、打包流程  
- ✅ **开箱即用**：包含所有依赖和配置文件
- ✅ **内网友好**：专为 OpenAI Compatible API 优化
- ✅ **Windows 原生**：生成标准 Windows 可执行文件

## 🛠️ 构建环境要求

### 必需组件
- **Windows 10/11** (64位)
- **Python 3.10-3.12**
- **互联网连接** (仅构建时需要)
- **8GB+ 可用磁盘空间**

### 推荐配置
- 16GB+ 内存
- SSD 硬盘
- 稳定的网络连接

## 🚀 快速开始

### 方法一：一键构建（推荐）

1. **下载构建脚本**
   ```bash
   # 如果在aider项目目录中，直接使用
   # 或者下载这两个文件：
   # - build_offline_windows_package.py
   # - build_aider_offline.bat
   ```

2. **运行构建**
   ```bash
   # 双击运行批处理文件
   build_aider_offline.bat
   
   # 或在命令行中运行
   python build_offline_windows_package.py
   ```

3. **等待完成**
   - 整个过程需要 10-30 分钟
   - 会自动下载依赖和编译

### 方法二：手动构建

```bash
# 1. 克隆或下载aider源码
git clone https://github.com/Aider-AI/aider.git
cd aider

# 2. 运行构建脚本
python build_offline_windows_package.py -o my_output_dir
```

## 📦 构建产物

构建完成后，在 `dist` 目录中会生成：

```
dist/
├── aider_windows_offline/          # 解压后的完整目录
│   ├── aider.exe                   # 主程序
│   ├── start_aider.bat            # 启动脚本
│   ├── example_start.bat          # 示例脚本
│   ├── .aider.conf.yml            # 默认配置
│   ├── .aider.model.settings.yml  # 模型设置
│   ├── README.md                  # 使用说明
│   ├── version_info.json          # 版本信息
│   └── ... (其他依赖文件)
└── aider_windows_offline.zip       # 压缩包 (便于传输)
```

## 🖥️ 部署到内网机器

### 1. 传输文件
```bash
# 将压缩包复制到目标机器
copy aider_windows_offline.zip \\target-machine\shared\
```

### 2. 解压安装
```bash
# 在目标机器上解压
unzip aider_windows_offline.zip
cd aider_windows_offline
```

### 3. 配置API连接

编辑 `.aider.conf.yml` 文件：

```yaml
# 基本配置
model: openai/your-model-name
api-base: http://your-internal-api-server:8000/v1
api-key: your-api-key

# 可选配置
max-tokens: 8192
temperature: 0.1
dark-mode: true
no-auto-commits: false
```

### 4. 启动使用

```bash
# 方法1：双击启动脚本
start_aider.bat

# 方法2：命令行启动
aider.exe

# 方法3：直接指定参数
aider.exe --model openai/your-model --api-base http://your-server:8000/v1
```

## 🔧 配置详解

### 环境变量方式
```batch
set OPENAI_API_BASE=http://your-internal-server:8000/v1
set OPENAI_API_KEY=your-api-key-here
set OPENAI_MODEL=your-model-name
```

### 命令行参数方式
```bash
aider --model openai/your-model ^
      --api-base http://your-server:8000/v1 ^
      --api-key your-api-key ^
      --max-tokens 8192
```

### 项目配置文件方式
在您的项目根目录创建 `.aider.conf.yml`：
```yaml
model: openai/your-internal-model
api-base: http://internal-api:8000/v1
api-key: project-specific-key
```

## 📖 使用示例

### 基本使用
```bash
# 进入项目目录
cd C:\your-project

# 启动aider
aider

# 开始对话
> 帮我添加一个新的功能模块
```

### 高级用法
```bash
# 指定特定文件
aider main.py utils.py

# 设置上下文窗口
aider --max-tokens 16384

# 禁用自动提交
aider --no-auto-commits

# 查看帮助
aider --help
```

## 🔍 故障排除

### 构建阶段问题

**1. Python版本错误**
```
错误：需要Python 3.10+
解决：安装正确的Python版本
```

**2. 网络连接问题**
```
错误：下载依赖失败
解决：检查网络连接，考虑使用代理
```

**3. 磁盘空间不足**
```
错误：No space left on device
解决：清理磁盘空间，至少需要8GB
```

### 运行阶段问题

**1. API连接失败**
```bash
# 测试API连接
curl -X POST http://your-server:8000/v1/chat/completions \
  -H "Authorization: Bearer your-api-key" \
  -H "Content-Type: application/json" \
  -d '{"model":"your-model","messages":[{"role":"user","content":"test"}]}'
```

**2. 模型不支持**
```
错误：Model not found
解决：确认模型名称和API兼容性
```

**3. 权限问题**
```
错误：Access denied
解决：检查API密钥和权限设置
```

## 🎨 自定义构建

### 修改构建脚本

可以通过修改 `build_offline_windows_package.py` 来自定义：

```python
# 添加额外依赖
optional_deps = ["help", "browser", "playwright"]

# 修改PyInstaller设置
hiddenimports.extend([
    'your_custom_module',
    'another_dependency'
])

# 添加自定义数据文件
datas.append(('your_data_folder', 'destination'))
```

### 构建参数

```bash
# 指定输出目录
python build_offline_windows_package.py -o custom_output

# 查看帮助
python build_offline_windows_package.py --help
```

## 📋 兼容性说明

### 支持的API服务
- ✅ **vLLM** (推荐)
- ✅ **Text Generation WebUI**
- ✅ **FastChat**
- ✅ **LocalAI**
- ✅ **Ollama** (通过API模式)
- ✅ **自定义OpenAI Compatible服务**

### 推荐模型
- **代码专用**: CodeLlama, DeepSeek-Coder, StarCoder
- **通用对话**: ChatGLM, Qwen, Baichuan
- **推理增强**: DeepSeek-R1, QwQ

### 性能要求
- **最低**: 4GB RAM, 双核CPU
- **推荐**: 16GB RAM, 四核CPU
- **理想**: 32GB RAM, 8核CPU + GPU

## 📞 技术支持

### 官方资源
- [Aider 官方文档](https://aider.chat/docs/)
- [GitHub 仓库](https://github.com/Aider-AI/aider)
- [问题反馈](https://github.com/Aider-AI/aider/issues)

### 常见问题
1. **Q**: 可以在Linux上构建Windows版本吗？
   **A**: 需要使用交叉编译工具，推荐在Windows上直接构建

2. **Q**: 生成的exe文件很大，可以压缩吗？
   **A**: 已启用UPX压缩，如需更小可考虑移除部分可选依赖

3. **Q**: 支持GPU加速吗？
   **A**: 客户端不需要GPU，GPU加速由API服务器端处理

---

## 📄 许可证

本构建脚本遵循 MIT 许可证，Aider 本身遵循 Apache 2.0 许可证。

**祝您使用愉快！** 🎉 